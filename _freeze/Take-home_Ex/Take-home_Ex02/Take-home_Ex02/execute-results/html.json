{
  "hash": "4d5263b156eae65e54868c18e58ab987",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take Home Exercise 02\"\nauthor: \"Pan Mingwei\"\ndate: \"September 24, 2024\"\ndate-modified: \"last-modified\"\nexecute: \n  eval: true\n  echo: true\n  warning: false\n  cache: true\n  freeze: true\nformat: \n  html: \n    code-fold: false\n    code-summary: \"Click to expand/collapse code\"\n---\n\n\n\n# 1. Overview\n\nDrug abuse is associated with significant negative health, financial and social consequences. Yet, illicit drug consumption remains highly prevalent and continues to be a growing problem worldwide. In 2021, 1 in 17 people aged 15–64 in the world had used a drug in the past 12 months. Notwithstanding population growth, the estimated number of drug users grew from 240 million in 2011 to 296 million in 2021.\n\nThe geopolitics of Thailand which is near the [Golden Triangle](https://en.wikipedia.org/wiki/Golden_Triangle_(Southeast_Asia)) of Indochina, the largest drug production site in Asia, and the constant transportation infrastructure development made Thailand became market and transit routes for drug trafficking to the third countries.\n\nIn Thailand, drug abuse is one of the major social issue. There are about 2.7 million youths using drugs in Thailand. Among youths aged between 15 and 19 years, there are about 300,000 who have needs for drug treatment. Most of Thai youths involved with drugs are vocational-school students, which nearly doubles in number compared to secondary-school students.\n\n## 1.1 The Objective\n\nThis take-home exercise will focus on determining:\n\n-   if the key indicators of drug abuse of Thailand are independent from space.\n\n-   If the indicators of drug abuse is indeed spatial dependent, then, identify where are the clusters and outliers, and the hotspots.\n\n-   Last, investigate how the observation above evolve over time.\n\n## 1.2 The Task\n\n-   Use **sf** and **tidyverse** to prepare the geospatial data layer:\n\n    -   a study area layer of province level(including Bangkok).\n\n    -   a drug abuse indicators layer within the study area.\n\n-   Perform Global Spatial Autocorrelation Analysis using **sfdep**.\n\n-   Perform Local Spatial Autocorrelation Analysis using **sfdep**.\n\n-   Analysis the spatial patterns.\n\n## 1.3 The Data\n\n-   [Thailand Drug Offenses \\[2017-2022\\]](https://www.kaggle.com/datasets/thaweewatboy/thailand-drug-offenses-2017-2022) at Kaggle.\n\n-   [Thailand - Subnational Administrative Boundaries](https://data.humdata.org/dataset/cod-ab-tha?) at HDX. You are required to use the province boundary data set.\n\n# 2. Getting Started\n\n## 2.1 Load R Packages\n\n-   **sf** is use for importing and handling geospatial data in R,\n\n-   **tidyverse** is mainly use for wrangling attribute data in R,\n\n-   **sfped,** builds on the great shoulders of spdep package for spatial dependence. sfdep creates an sf and tidyverse friendly interface\n\n-   **tmap** will be used to prepare cartographic quality choropleth map.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, sfdep, tmap, tidyverse)\n```\n:::\n\n\n\n## 2.2 Load the Data\n\n### 2.2.1 Geospatial Data\n\nLoading the Thailand_Subnational_Administrative1_Boundaries dataset, which contain the province boundary including Bandkok of Thailand. Using `st_read()` of **sf** package.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthailand_sf <- st_read(dsn = \"data/geospatial\", \n                 layer = \"Thailand_Subnational_Administrative1_Boundaries\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `Thailand_Subnational_Administrative1_Boundaries' from data source `/Users/mingwei/Desktop/SMU/Y3S1/IS415/xXxPMWxXx/IS415-GAA/Take-home_Ex/Take-home_Ex02/data/geospatial' \n  using driver `ESRI Shapefile'\nSimple feature collection with 77 features and 16 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n\n\nThere are 77 geographic features, which aligns with expectations. This includes 76 provinces at the first-order administrative level and the capital city, Bangkok.\n\nNext, lets visualise **thailand_sf** using **tmap** package.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\ntm_shape(thailand_sf)+\n  tm_fill(col=\"white\")+\n  tm_borders(col = \"black\", lwd=0.5, alpha=0.5)+\n  tm_layout(\n    main.title = \"Thailand Provinces (including Bandkok)\",\n    main.title.size = 1.5,\n    main.title.position = \"center\",\n    legend.show = FALSE,\n     frame = FALSE)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-3-1.png){width=1152}\n:::\n:::\n\n\n\n### 2.2.2 Aspatial Data\n\nLoad Thailand drug offenses\\[2017 - 2022\\] dataset, using **`read_csv()`** from **readr** package.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndrug <- read_csv(\"data/aspatial/thai_drug_offenses_2017_2022.csv\")\n```\n:::\n\n\n\n# 3. Data Wrangling\n\n## 3.1 Remove Columns\n\nAs there some columns that would not be useful in our analysis. Therefore, it is good practice by removing those column.\n\nBefore we removing the column. Lets list down the column for the two data set.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolnames(thailand_sf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"Shape_Leng\" \"Shape_Area\" \"ADM1_EN\"    \"ADM1_TH\"    \"ADM1_PCODE\"\n [6] \"ADM1_REF\"   \"ADM1ALT1EN\" \"ADM1ALT2EN\" \"ADM1ALT1TH\" \"ADM1ALT2TH\"\n[11] \"ADM0_EN\"    \"ADM0_TH\"    \"ADM0_PCODE\" \"date\"       \"validOn\"   \n[16] \"validTo\"    \"geometry\"  \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncolnames(drug)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"fiscal_year\"            \"types_of_drug_offenses\" \"no_cases\"              \n[4] \"province_th\"            \"province_en\"           \n```\n\n\n:::\n:::\n\n\n\nBased on the columns list on the two dataset and after browsing the data, the following fields I will keep:\n\n-   thailand_sf\n\n    -   ADM1_EN (common field with the drug dataset) =\\> column 3\n\n    -   geometry =\\> column 17\n\n-   drug\n\n    -   fiscal_year =\\> column 1\n\n    -   types_of_drug_offenses =\\> column 2\n\n    -   no_cases =\\> column 3\n\n    -   province_en =\\> column 5\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthailand_sf <- thailand_sf %>%\n  select(\"province_en\" = 3,17) # change the ADM1_EN to province_en\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndrug <- drug %>%\n  select(1:3,5)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsum(apply(drug, 1, function(x) any(is.na(x))))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0\n```\n\n\n:::\n:::\n\n\n\n## 3.2 Checking the common field\n\nSince we need to join the two datasets, it’s important to ensure that all the values in the common column match correctly.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncheck_match <- setdiff(thailand_sf$province_en, drug$province_en)\ncheck_match # print the mismatch field in thailand_sf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Lop Buri\"  \"Bueng Kan\"\n```\n\n\n:::\n\n```{.r .cell-code}\ncheck_match <- setdiff(drug$province_en, thailand_sf$province_en)\ncheck_match # print the mismatch field in drug\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Loburi\"  \"buogkan\"\n```\n\n\n:::\n:::\n\n\n\nI observe that two provinces have names in different formats (\"Lop Buri\" and \"Bueng Kan\"). Let's modify the values in the `drug` dataset to match the naming convention used in the `thailand_sf` dataset.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndrug <- drug %>%\n  mutate(province_en = case_when(\n    province_en == \"Loburi\" ~ \"Lop Buri\",\n    province_en == \"buogkan\" ~ \"Bueng Kan\",\n    TRUE ~ province_en\n  ))\n```\n:::\n\n\n\nLets check, if there still have any mismatch.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncheck_match <- setdiff(thailand_sf$province_en, drug$province_en)\ncheck_match\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ncharacter(0)\n```\n\n\n:::\n:::\n\n\n\n## 3.3 Checking Types of Drug Offenses\n\nAs in the dataset, there are many different types of drug offenses. In order to get better insight. I decide to further check in the column and see which are the type I should consider.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunique_types <- unique(drug$types_of_drug_offenses)\nprint(unique_types)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"drug_use_cases\"                                        \n [2] \"suspects_in_drug_use_cases\"                            \n [3] \"possession_cases\"                                      \n [4] \"suspects_in_possession_cases\"                          \n [5] \"possession_with_intent_to_distribute_cases\"            \n [6] \"suspects_in_possession_with_intent_to_distribute_cases\"\n [7] \"trafficking_cases\"                                     \n [8] \"suspects_in_trafficking_cases\"                         \n [9] \"production_cases\"                                      \n[10] \"suspects_in_production_cases\"                          \n[11] \"import_cases\"                                          \n[12] \"suspects_in_import_cases\"                              \n[13] \"export_cases\"                                          \n[14] \"suspects_in_export_cases\"                              \n[15] \"conspiracy_cases\"                                      \n[16] \"suspects_in_conspiracy_cases\"                          \n```\n\n\n:::\n:::\n\n\n\nTo get a better sense of the field, and decide which type I should focus on. I will group the type using the code chunk.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndrug_counts <- drug %>%\n  group_by(types_of_drug_offenses) %>%\n  summarise(total_cases = sum(no_cases, na.rm = TRUE),, .groups = 'drop')\n```\n:::\n\n\n\nTo visualise the data.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(drug_counts, aes(x = types_of_drug_offenses, y = total_cases, fill = types_of_drug_offenses)) +\n  geom_bar(stat = \"identity\") +  # Use stat = \"identity\" for summarized data\n  labs(title = \"Total Cases of Drug Offenses by Type\",\n       x = \"Types of Drug Offenses\",\n       y = \"Total Cases\") +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels for better visibility\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-15-1.png){width=1152}\n:::\n:::\n\n\n\nBased on the plot,in order to focuse on the drug abuse case, I will retain the drug use cases.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndrug_use_cases <- drug %>%\n  filter(types_of_drug_offenses == \"drug_use_cases\")\n```\n:::\n\n\n\nSince, there is no mismatch in the province_en column, we can combine both data frame using **`left_join()`** of **dplyr** package.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndrug_use_cases <- left_join(thailand_sf, drug_use_cases)\n```\n:::\n\n\n\nLets visualising the drug use case over the years.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\ntm_shape(drug_use_cases) +\n  tm_fill(\"no_cases\", \n          style = \"quantile\", \n          palette = \"Blues\",\n          title = \"total_cases\") +\n  tm_layout(main.title = \"Distribution of drug use cases\",\n            main.title.position = \"center\",\n            main.title.size = 1.2,\n            legend.height = 0.45, \n            legend.width = 0.35,\n            frame = TRUE) +\n  tm_facets(by = \"fiscal_year\", free.coords = FALSE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", size = 2) +\n  tm_scale_bar() +\n  tm_grid(alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-18-1.png){width=1152}\n:::\n:::\n\n\n\n# 4. Global Measures of Spatial Autocorrelation\n\nTo evaluate the overall degree of spatial dependence (autocorrelation) across the entire study area for each year.\n\n## 4.1 Global Moran's I Test\n\nI decided to use Queen contiguity for the neighbors, as it shares both edges and corners, providing a more comprehensive result in helping me determine whether the drug use cases are independent of their locations.\n\nI've observed that Phuket(67) is an island, which means that `st_contiguity` cannot identify any polygon neighbors for it. Therefore, I will set allow_zero to be TRUE.\n\n![](website_img/Phuket_location.jpg){fig-align=\"center\"}\n\n::: panel-tabset\n## 2017\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# Deriving Queen’s contiguity weights\nwm_q_2017 <- drug_use_cases %>%\n  filter(fiscal_year == 2017) %>%\n  mutate(nb = st_contiguity(geometry),\n         wt = st_weights(nb,\n                         style = \"W\", allow_zero = TRUE),\n         .before = 1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_moran_test(wm_q_2017$no_cases,\n                       wm_q_2017$nb,\n                       wm_q_2017$wt,\n                       zero.policy = TRUE,)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMoran I test under randomisation\n\ndata:  x  \nweights: listw  \nn reduced by no-neighbour observations  \n\nMoran I statistic standard deviate = 1.5049, p-value = 0.06618\nalternative hypothesis: greater\nsample estimates:\nMoran I statistic       Expectation          Variance \n      0.077263424      -0.013333333       0.003624223 \n```\n\n\n:::\n:::\n\n\n\nThe results show an I value of 0.077, is close to zero, and a p-value of 0.06618, which exceeds the alpha level of 0.05. Therefore, we **do not have sufficient statistical evidence** to reject the null hypothesis, indicating that the spatial distribution of drug use cases in Thailand was random in 2017.\n\nTo strengthen the finding, we can run Monte carlo simulation to perform the statistical test.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234) # To ensure reproducible\nglobal_moran_perm(wm_q_2017$no_cases,\n                       wm_q_2017$nb,\n                       wm_q_2017$wt,\n                        nsim=999,\n                       zero.policy = TRUE,)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.077263, observed rank = 922, p-value = 0.156\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n\n\nFrom the simulation results, we can observed that the I value are very similar and the p-value have increased, which further indicate that we **cannot reject** the null hypothesis.\n\n## 2018\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# Deriving Queen’s contiguity weights\nwm_q_2018 <- drug_use_cases %>%\n  filter(fiscal_year == 2018) %>%\n  mutate(nb = st_contiguity(geometry),\n         wt = st_weights(nb,\n                         style = \"W\", allow_zero = TRUE),\n         .before = 1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_moran_test(wm_q_2018$no_cases,\n                       wm_q_2018$nb,\n                       wm_q_2018$wt,\n                       zero.policy = TRUE,)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMoran I test under randomisation\n\ndata:  x  \nweights: listw  \nn reduced by no-neighbour observations  \n\nMoran I statistic standard deviate = 1.673, p-value = 0.04716\nalternative hypothesis: greater\nsample estimates:\nMoran I statistic       Expectation          Variance \n      0.091283835      -0.013333333       0.003910294 \n```\n\n\n:::\n:::\n\n\n\nFrom the above result with I = 0.09 and the p-value = 0.4716 is smaller than alpha value of 0.05. Hence, we have statistical evidence to **reject** the null hypothesis and since the I value is positive but close to 0, so we can infer that the spatial distribution shows a **weak sign of clustering** in 2018.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234) # To ensure reproducible\nglobal_moran_perm(wm_q_2018$no_cases,\n                       wm_q_2018$nb,\n                       wm_q_2018$wt,\n                        nsim=999,\n                       zero.policy = TRUE,)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.091284, observed rank = 944, p-value = 0.112\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n\n\nHowever, based on the simulation, we can observed that the p-value has become larger than the alpha value of 0.05. Hence, based on the simulation result, we **do not have statistical evidence** to **reject** the null hypothesis that the spatial distribution of drug use case in Thailand are resemble random distribution for Year 2018.\n\n## 2019\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Deriving Queen’s contiguity weights\nwm_q_2019 <- drug_use_cases %>%\n  filter(fiscal_year == 2019) %>%\n  mutate(nb = st_contiguity(geometry),\n         wt = st_weights(nb,\n                         style = \"W\", allow_zero = TRUE),\n         .before = 1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_moran_test(wm_q_2019$no_cases,\n                       wm_q_2019$nb,\n                       wm_q_2019$wt,\n                       zero.policy = TRUE,)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMoran I test under randomisation\n\ndata:  x  \nweights: listw  \nn reduced by no-neighbour observations  \n\nMoran I statistic standard deviate = 2.1385, p-value = 0.01624\nalternative hypothesis: greater\nsample estimates:\nMoran I statistic       Expectation          Variance \n      0.138046280      -0.013333333       0.005010889 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234) # To ensure reproducible\nglobal_moran_perm(wm_q_2019$no_cases,\n                       wm_q_2019$nb,\n                       wm_q_2019$wt,\n                        nsim=999,\n                       zero.policy = TRUE,)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.13805, observed rank = 972, p-value = 0.056\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n\n\nBased on the Moran I test and simulation result, we can observed that the p-value have become larger than 0.05 in the statistical test. Hence, we **do not have enough statistical evidence** to reject the null hypothesis that the spatial distribution of drug use case in Thailand are resemble random distribution for Year 2019. However, notice that the p-value is actually very close to the alpha value of 0.05, so based on this, we can infer that even we do not have enough statistical evidence to reject the null hypothesis, but it also give us insight that the drug use case in 2019, is probably higher than Year 2017 and 2018.\n\n## 2020\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Deriving Queen’s contiguity weights\nwm_q_2020 <- drug_use_cases %>%\n  filter(fiscal_year == 2020) %>%\n  mutate(nb = st_contiguity(geometry),\n         wt = st_weights(nb,\n                         style = \"W\", allow_zero = TRUE),\n         .before = 1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_moran_test(wm_q_2020$no_cases,\n                       wm_q_2020$nb,\n                       wm_q_2020$wt,\n                       zero.policy = TRUE,)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMoran I test under randomisation\n\ndata:  x  \nweights: listw  \nn reduced by no-neighbour observations  \n\nMoran I statistic standard deviate = 1.382, p-value = 0.08349\nalternative hypothesis: greater\nsample estimates:\nMoran I statistic       Expectation          Variance \n      0.087091664      -0.013333333       0.005280586 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234) # To ensure reproducible\nglobal_moran_perm(wm_q_2020$no_cases,\n                       wm_q_2020$nb,\n                       wm_q_2020$wt,\n                        nsim=999,\n                       zero.policy = TRUE,)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.087092, observed rank = 924, p-value = 0.152\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n\n\nBased on the Moran I test and simulation result, we can observed that the p-value have become larger than 0.05 in the statistical test. Hence, we **do not have enough statistical evidence** to reject the null hypothesis that the spatial distribution of drug use case in Thailand are resemble random distribution for Year 2020.\n\n## 2021\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Deriving Queen’s contiguity weights\nwm_q_2021 <- drug_use_cases %>%\n  filter(fiscal_year == 2021) %>%\n  mutate(nb = st_contiguity(geometry),\n         wt = st_weights(nb,\n                         style = \"W\", allow_zero = TRUE),\n         .before = 1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_moran_test(wm_q_2021$no_cases,\n                       wm_q_2021$nb,\n                       wm_q_2021$wt,\n                       zero.policy = TRUE,)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMoran I test under randomisation\n\ndata:  x  \nweights: listw  \nn reduced by no-neighbour observations  \n\nMoran I statistic standard deviate = 2.862, p-value = 0.002105\nalternative hypothesis: greater\nsample estimates:\nMoran I statistic       Expectation          Variance \n       0.20376109       -0.01333333        0.00575372 \n```\n\n\n:::\n:::\n\n\n\nFrom the above result with I = 0.077\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234) # To ensure reproducible\nglobal_moran_perm(wm_q_2021$no_cases,\n                       wm_q_2021$nb,\n                       wm_q_2021$wt,\n                        nsim=999,\n                       zero.policy = TRUE,)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.20376, observed rank = 993, p-value = 0.014\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n\n\nBased on the Moran I test and simulation result, we can observed that the p-value is still smaller than 0.05 in the statistical test. Hence, we **have enough statistical evidence** to reject the null hypothesis that the spatial distribution of drug use case in Thailand are not resemble random distribution for Year 2021. Since I is positive value of 0.2, hence we can infer that the spatial distribution of drag use in Thailand in 2021 shows sign of **weak clustering**.\n\n## 2022\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Deriving Queen’s contiguity weights\nwm_q_2022 <- drug_use_cases %>%\n  filter(fiscal_year == 2022) %>%\n  mutate(nb = st_contiguity(geometry),\n         wt = st_weights(nb,\n                         style = \"W\", allow_zero = TRUE),\n         .before = 1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_moran_test(wm_q_2022$no_cases,\n                       wm_q_2022$nb,\n                       wm_q_2022$wt,\n                       zero.policy = TRUE,)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMoran I test under randomisation\n\ndata:  x  \nweights: listw  \nn reduced by no-neighbour observations  \n\nMoran I statistic standard deviate = 2.7688, p-value = 0.002813\nalternative hypothesis: greater\nsample estimates:\nMoran I statistic       Expectation          Variance \n      0.197931897      -0.013333333       0.005822019 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234) # To ensure reproducible\nglobal_moran_perm(wm_q_2022$no_cases,\n                       wm_q_2022$nb,\n                       wm_q_2022$wt,\n                        nsim=999,\n                       zero.policy = TRUE,)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.19793, observed rank = 994, p-value = 0.012\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n\n\nSimilar to Year 2021, we can observed that the p-value is still smaller than 0.05 in the statistical test. Hence, we **have enough statistical evidence** to reject the null hypothesis that the spatial distribution of drug use case in Thailand are not resemble random distribution for Year 2022 and shows sign of **weak clustering**.\n:::\n\n::: callout-tip\n## Overall Observation\n\n-   Overall, we can observed that from the **Year 2017 to 2019**, the trend are increasing in term of I value and decreasing in p-value. But the p-value over the three years are still larger than the alpha value of 0.05. Hence, we **do not have enough statistical evidence** to reject the null hypothesis that the spatial distribution of drug use case in Thailand are resemble random distribution.\n\n-   In the **Year** **2020**, the trend broke, with the I value decreasing instead of continuing to increase, and the p-value increasing instead of decreasing. This suggests a stronger indication of randomness in the distribution. I believe this change is due to COVID-19, which resulted in a decrease in recorded drug use cases.\n\n-   In the Year 2021 - 2022, there are enough statistical evidence to reject the null hypothesis and we can infer that the spatial distribution of drug use cases **shows sign of weak clustering.**\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}