{
  "hash": "9221c6a757788438f5760f4ad04b6590",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"In-class Exercise 11: Geographically Weighted Regression\"\nauthor: \"Pan Mingwei\"\ndate: \"November 4, 2024\"\ndate-modified: \"last-modified\"\nexecute: \n  eval: true\n  echo: true\n  warning: false\n  freeze: true\n---\n\n\n\n::: callout-note\n-   Fixed distance vs Adaptive distance\n\n    -   Fixed distance =\\> we define the fixed bandwidth in meters.\n\n    -   Adaptive distance =\\> we define the number of data point, instead of meters.\n:::\n\n# Loading R package\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, sf, tmap, httr, performance)\n```\n:::\n\n\n\n# Importing Data \n\nThe code chunk below import multiple file and append them into a single tibble data frame.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfolder_path <- \"data/aspatial\"\nfile_list <- list.files(path = folder_path,\n                        pattern = \"^realis.*\\\\.csv$\",\n                        full.names = TRUE)\n\n# realise_data <- file_list %>%\n#   map_dfr(read.csv)\n\n# To avoid R removing the leadin 0 in the postal code\nrealise_data <- file_list %>%\n  map_dfr(~ read.csv(.x, colClasses = c(\"Postal.Code\" = \"character\")))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(realise_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t16643 obs. of  21 variables:\n $ Project.Name               : chr  \"THE LANDMARK\" \"POLLEN COLLECTION\" \"SKY EDEN@BEDOK\" \"TERRA HILL\" ...\n $ Transacted.Price....       : chr  \"2,726,888\" \"3,850,000\" \"2,346,000\" \"2,190,000\" ...\n $ Area..SQFT.                : chr  \"1,076.4\" \"1,808.35\" \"1,087.16\" \"807.3\" ...\n $ Unit.Price....PSF.         : chr  \"2,533\" \"2,129\" \"2,158\" \"2,713\" ...\n $ Sale.Date                  : chr  \"01 Jan 2024\" \"01 Jan 2024\" \"01 Jan 2024\" \"01 Jan 2024\" ...\n $ Address                    : chr  \"173 CHIN SWEE ROAD #22-11\" \"34 POLLEN PLACE\" \"1 BEDOK CENTRAL #09-10\" \"18A YEW SIANG ROAD #03-12\" ...\n $ Type.of.Sale               : chr  \"New Sale\" \"New Sale\" \"New Sale\" \"New Sale\" ...\n $ Type.of.Area               : chr  \"Strata\" \"Land\" \"Strata\" \"Strata\" ...\n $ Area..SQM.                 : chr  \"100\" \"168\" \"101\" \"75\" ...\n $ Unit.Price....PSM.         : chr  \"27,269\" \"22,917\" \"23,228\" \"29,200\" ...\n $ Nett.Price...              : chr  \"-\" \"-\" \"-\" \"-\" ...\n $ Property.Type              : chr  \"Condominium\" \"Terrace House\" \"Apartment\" \"Apartment\" ...\n $ Number.of.Units            : int  1 1 1 1 1 1 1 1 1 1 ...\n $ Tenure                     : chr  \"99 yrs from 28/08/2020\" \"99 yrs from 09/12/2019\" \"99 yrs from 05/01/2022\" \"Freehold\" ...\n $ Completion.Date            : chr  \"Uncompleted\" \"Uncompleted\" \"Uncompleted\" \"Uncompleted\" ...\n $ Purchaser.Address.Indicator: chr  \"Private\" \"N.A\" \"HDB\" \"N.A\" ...\n $ Postal.Code                : chr  \"169878\" \"807233\" \"469657\" \"118992\" ...\n $ Postal.District            : int  3 28 16 5 21 21 19 28 19 20 ...\n $ Postal.Sector              : int  16 80 46 11 59 58 53 79 53 57 ...\n $ Planning.Region            : chr  \"Central Region\" \"North East Region\" \"East Region\" \"Central Region\" ...\n $ Planning.Area              : chr  \"Outram\" \"Serangoon\" \"Bedok\" \"Queenstown\" ...\n```\n\n\n:::\n:::\n\n\n\n# Wrangling Data\n\nNotice that the Sale Date and Postal Code are in wrong format.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncondo_resale <- realise_data %>%\n  mutate(`Sale.Date` = dmy(`Sale.Date`)) %>%\n  filter(`Type.of.Sale` == \"Resale\" &\n           `Property.Type` == \"Condominium\")\n```\n:::\n\n\n\n# Geocoding\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npostcode <- unique(condo_resale$Postal.Code)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <- \"https://onemap.gov.sg/api/common/elastic/search\"\nfound <- data.frame()\nnon_found <- data.frame()\n\nfor (postcode in postcode) {\n  query <- list('searchVal'=postcode,'returnGeom'='Y',\n                'getAddrDetails'='Y', 'pageNum'='1')\n  res <- GET(url, query=query)\n  \n  if((content(res)$found)!=0){\n    found <- rbind(found, data.frame(content(res))[4:13])\n  }else {non_found = data.frame(postcode)}\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(found,\"data/rds/found.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfound <- read_rds(\"data/rds/found.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfound <- found %>%\n  select(c(6:8)) %>%\n  rename(POSTAL = `results.POSTAL`,\n          XCOORD = `results.X`,\n          YCOORD = `results.Y`)\n```\n:::\n\n\n\n## Join tables\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncondo_resale_geocoded = left_join(\n  condo_resale, found,\n  by = c('Postal.Code' = 'POSTAL')\n)\n```\n:::\n\n\n\n## Converting to SF\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncondo_resale_sf <- st_as_sf(condo_resale_geocoded,\n                            coords = c(\"XCOORD\",\"YCOORD\"),\n                            crs=3414)\n```\n:::\n\n\n\n## Cleaning Spatial Data\n\nCheck if there is overlaying location.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\noverlapping_points <- condo_resale_sf %>%\n   mutate(overlap = length(st_equals(., .)) > 1)\n```\n:::\n\n\n\n## Spatial jittering\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncondo_resale_sf <- condo_resale_sf %>%\n  st_jitter(amount = 2)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(condo_resale_sf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 6 features and 21 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 30411.28 ymin: 29119.02 xmax: 40397.12 ymax: 39219.39\nProjected CRS: SVY21 / Singapore TM\n           Project.Name Transacted.Price.... Area..SQFT. Unit.Price....PSF.\n1             CASA ROSA            1,500,000    1,367.03              1,097\n2            THE MINTON            1,840,000    1,216.33              1,513\n3         NV RESIDENCES            1,350,000    1,108.69              1,218\n4             SANT RITZ              890,000      527.44              1,687\n5                   ECO            1,620,000      990.29              1,636\n6 MARINA BAY RESIDENCES            1,420,000      710.42              1,999\n   Sale.Date                         Address Type.of.Sale Type.of.Area\n1 2024-01-01        35 LORONG ONG LYE #01-05       Resale       Strata\n2 2024-01-02      6 HOUGANG STREET 11 #11-09       Resale       Strata\n3 2024-01-02       99 PASIR RIS GROVE #08-47       Resale       Strata\n4 2024-01-02      1 PHENG GECK AVENUE #06-24       Resale       Strata\n5 2024-01-02 275 BEDOK SOUTH AVENUE 3 #01-22       Resale       Strata\n6 2024-01-02      18 MARINA BOULEVARD #26-04       Resale       Strata\n  Area..SQM. Unit.Price....PSM. Nett.Price... Property.Type Number.of.Units\n1        127             11,811             -   Condominium               1\n2        113             16,283             -   Condominium               1\n3        103             13,107             -   Condominium               1\n4         49             18,163             -   Condominium               1\n5         92             17,609             -   Condominium               1\n6         66             21,515             -   Condominium               1\n                  Tenure Completion.Date Purchaser.Address.Indicator\n1 99 yrs from 02/02/1998            2001                     Private\n2 99 yrs from 27/07/2007            2013                         HDB\n3 99 yrs from 07/01/2008            2013                         HDB\n4 99 yrs from 01/10/2012            2016                         HDB\n5 99 yrs from 14/05/2012            2017                     Private\n6 99 yrs from 11/10/2005            2010                         HDB\n  Postal.Code Postal.District Postal.Sector   Planning.Region Planning.Area\n1      536443              19            53 North East Region     Serangoon\n2      538755              19            53 North East Region       Hougang\n3      518194              18            51       East Region     Pasir Ris\n4      348196              13            34    Central Region     Toa Payoh\n5      465491              16            46       East Region         Bedok\n6      018980               1             1    Central Region Downtown Core\n                   geometry\n1  POINT (33157.13 36487.3)\n2 POINT (33396.04 37059.57)\n3 POINT (40397.12 39219.39)\n4 POINT (31998.06 34652.28)\n5 POINT (40396.93 33981.95)\n6 POINT (30411.28 29119.02)\n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}